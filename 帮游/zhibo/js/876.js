(function(){function e(e){e=e||{},this.path=e.path||"/",this.domain=e.domain||"",this.expires=e.expires||31536e6,this.secure=e.secure||""}e.prototype={set:function(e,t){var n=new Date;typeof this.expires=="number"&&n.setTime(n.getTime()+this.expires),document.cookie=e+"="+escape(t)+";expires="+n.toGMTString()+";path="+this.path+(this.domain==""?"":"; domain="+this.domain)+(this.secure?"; secure":"")},get:function(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?unescape(t[2]):""},remove:function(e){var t=this.expires;this.expires=-31536e6,this.set(e,""),this.expires=t}},e.set=function(t,n,r){(new e(r)).set(t,n)},e.get=function(t,n){return(new e(n)).get(t)},e.remove=function(t,n){(new e(n)).remove(t)},QW.provide("Cookie",e)})(),function(){var e=new Cookie,t=e.get("watchedRoom");t&&(t=t.split(";"),t.length>5&&(t.splice(5,t.length),e.set("watchedRoom",t.join(";"))))}();(function(){var e=10,t=",",n="|",r=window.location.hostname,i=r.indexOf("360kan")>=0?"360kan.com":"v.360.cn",s={total:"total_history",dianying:"dianying_history",tv:"dianshi_history",dongman:"dongman_history",zongyi:"zongyi_history",all:"view_history"},o={total:"total",dianying:"dianying",tv:"tv",dongman:"dongman",zongyi:"zongyi"},u={total:"total",dianying:"movie",tv:"tv",dongman:"cartoon",zongyi:"zy"},a={get:function(e){var t="",n;return n=Cookie.get(e),t=null==n?"":n,t},set:function(e,t){Cookie.set(e,t,{domain:i,expires:2592e6,path:"/"})},remove:function(e){Cookie.remove(e,{domain:i,path:"/"})},setLocalStore:function(e,t,n,r){var i=e.get(t);i||(i={list:[]}),i[n]||(i[n]=[],i.list.push(n)),i[n].push(r),i.list.length>=11&&delete i[i.list.shift()],e.set(t,i)},getSKeyByType:function(e){return s[e]},getVideotypeByPlaytype:function(e){return o[e]},getDomPrefixByPlaytype:function(e){return u[e]},getAllVideoType:function(){var e=[];for(var t in s)e.push(t);return e},getAllPlayType:function(){var e=[];for(var t in o)e.push(t);return e},makeARecord:function(e,t,r,i,s,o,u,a){var f=typeof i=="undefined"||""==i?+(new Date):i;return typeof s=="undefined"?[e,t,r,f,a].join(n):[e,t,r,f,s,o,u,a].join(n)},parseAKey:function(e){var r=a.getSKeyByType(e),i=a.get(r),s,o=[],u;if(""==i)return[];e=="all"?s=i.match(/((.*?)\|(movie|tv|comics|arts|doc))(,)?/g):s=i.split(t);if(!s)return[];for(var f=0;f<s.length;++f){var l=s[f];l.substring(l.length-1,l.length)==","&&(l=l.substring(0,l.length-1)),u=l.split(n),u.length==8&&o.push({movie_id:u[0],title:u[1],url:u[2],watch_time:u[3],now_playing:u[4],new_id:u[5],site_name:u[6],play_type:u[7]})}return o},pushARecord2AKey:function(n,r,i,s,o,u,f,l){var c=a.getSKeyByType(n),h=a.parseAKey(n),p,d=[],v;for(var m=0;m<h.length;++m)if(r==h[m]["movie_id"]){h.splice(m,1);break}typeof o=="undefined"?d.push(a.makeARecord(r,i,s,"",l)):d.push(a.makeARecord(r,i,s,"",o,u,f,l));for(m=0;m<h.length;++m){v="tv"==n?10:e;if(d.length>=v)break;p=h[m],typeof p["now_playing"]=="undefined"?d.push(a.makeARecord(p.movie_id,p.title,p.url,p.watch_time,p.play_type)):d.push(a.makeARecord(p.movie_id,p.title,p.url,p.watch_time,p.now_playing,p.new_id,p.site_name,p.play_type))}a.set(c,d.join(t))},removeAMovie:function(n,r){var i=a.getSKeyByType(n),s=a.parseAKey(n),o=[];for(var u=0;u<s.length;++u)if(r==s[u]["movie_id"]){s.splice(u,1);break}for(u=0;u<s.length;++u){if(o.length>=e)break;tmp=s[u],typeof tmp["now_playing"]=="undefined"?o.push(a.makeARecord(tmp.movie_id,tmp.title,tmp.url,tmp.watch_time,tmp.play_type)):o.push(a.makeARecord(tmp.movie_id,tmp.title,tmp.url,tmp.watch_time,tmp.now_playing,tmp.new_id,tmp.site_name,tmp.play_type))}a.set(i,o.join(t))},removeAKey:function(e){var t=a.getSKeyByType(e);a.remove(t)}};window.watchmanager=a})();var JSON;JSON||(JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}"use strict",typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(){var e={},t="ns";e.localStorage={test:function(){try{return window.localStorage?!0:!1}catch(e){return!1}},methods:{init:function(e){},set:function(e,t,n){try{localStorage.setItem(e+t,n)}catch(r){throw r}},get:function(e,t){return localStorage.getItem(e+t)},remove:function(e,t){localStorage.removeItem(e+t)},clear:function(e){if(!e)localStorage.clear();else for(var t=0,n;n=localStorage.key(t++);)n&&n.indexOf(e)===0&&localStorage.removeItem(n)}}},e.userData={test:function(){try{return window.ActiveXObject&&document.documentElement.addBehavior?!0:!1}catch(e){return!1}},methods:{_owners:{},init:function(e){if(!this._owners[e]){if(document.getElementById(e))this._owners[e]=document.getElementById(e);else{var t=document.createElement("script"),n=document.head||document.getElementsByTagName("head")[0]||document.documentElement;t.id=e,t.style.display="none",t.addBehavior("#default#userdata"),n.insertBefore(t,n.firstChild),this._owners[e]=t}try{this._owners[e].load(e)}catch(r){}var i=this;window.attachEvent("onunload",function(){i._owners[e]=null})}},set:function(e,t,n){if(this._owners[e])try{this._owners[e].setAttribute(t,n),this._owners[e].save(e)}catch(r){throw r}},get:function(e,t){return this._owners[e]?(this._owners[e].load(e),this._owners[e].getAttribute(t)||""):""},remove:function(e,t){this._owners[e]&&(this._owners[e].removeAttribute(t),this._owners[e].save(e))},clear:function(e){if(this._owners[e]){var t=this._owners[e].XMLDocument.documentElement.attributes;this._owners[e].load(e);for(var n=0,r;r=t[n];n++)this._owners[e].removeAttribute(r.name);this._owners[e].save(e)}}}};var n=function(){return e.localStorage.test()?e.localStorage.methods:e.userData.test()?e.userData.methods:{init:function(){},get:function(){},set:function(){},remove:function(){},clear:function(){}}}(),r={},i=function(e){this._cache={},this._ns=t+"_"+e+"_",this._inited=!1,n&&!this._inited&&n.init(this._ns)};i.serialize=function(e){return JSON.stringify(e)},i.unserialize=function(e){return JSON.parse(e)},i.prototype={set:function(e,t){this._cache[e]=t;try{return n.set(this._ns,e,i.serialize(t)),!0}catch(r){return!1}},get:function(e){if(this._cache[e])return this._cache[e];try{return this._cache[e]=i.unserialize(n.get(this._ns,e))}catch(t){return""}},remove:function(e){try{n.remove(this._ns,e)}catch(t){}this._cache[e]=null,delete this._cache[e]},clear:function(){try{n.clear(this._ns)}catch(e){}this._cache={}}},i.ins=function(e){return r[e]||(r[e]=new i(e)),r[e]},window.cacheSvc=i}();(function(){var e={record:function(e,t,n,r){var i=(new Date).getTime(),s=window["silentlog-v"]=new Image,o="";try{o=monitor.util.getGuid()}catch(u){}s.onload=s.onerror=function(){try{window["silentlog-v"]=null,delete window["silentlog-v"]}catch(e){}};var a="";r&&(a="&id="+r),n?s.src="http://click.stat.hao.360.cn/clk.gif?t="+i+"&type="+e+"&to="+t+"&from="+n+a+"&guid="+o:s.src="http://click.stat.hao.360.cn/clk.gif?t="+i+"&type="+e+"&to="+t+a+"&guid="+o},recordByElement:function(t){var n=W(t),r=n.attr("needrecord")||"",i=n.attr("playtype")||"",s=n.attr("sitename")||"",o=n.attr("sitefrom")||"",u=n.attr("movieid")||"";if(r!="record"||i==""||s=="")return;e.record(i,s,o,u)}};window.watchmanagerstater=e})();(function(){function a(){var e=new Date,t={date:DateH.format(e,"yyyy-MM-dd"),day:"\u661f\u671f"+u[e.getDay()],time:DateH.format(e,"hh:mm:ss")};return e=null,t}function f(){var e=a(),t=['<span class="date">',e.date,'</span><span class="week">',e.day,'</span><span class="time">',e.time,"</span>"].join("");o.html(t),setTimeout(function(){f()},1e3)}function l(e){var t=W("."+e),n=t.query(".tabitem a"),r=t.query(".viewitem");n.on("click",function(e){e.preventDefault();var t=W(this),i=t.parentNode().previousSiblings("*").length;n.removeClass("on").item(i).addClass("on"),r.removeClass("view-active").item(i).addClass("view-active")})}function c(e,t){if(!e)return W("#live-list .list-container .list-item").html('<div class="empty">\u6682\u65e0\u6570\u636e\uff01</div'),!1;var n=e.epgs.am,r=e.epgs.pm,i="",s="";i="<ul class='column'>";for(var o=0,u=n.length;o<u;o++)n[o].nowplay?i+="<li><a href='"+t+"'><span class='time'>"+n[o].start+"</span>"+n[o].name+"--\u6b63\u5728\u76f4\u64ad</a></li>":i+="<li><span class='time'>"+n[o].start+"</span>"+n[o].name+"</li>";i+="</ul>",s="<ul class='column'>";for(var o=0,u=r.length;o<u;o++)r[o].nowplay?s+="<li><a href='"+t+"'><span class='time'>"+r[o].start+"</span>"+r[o].name+"--\u6b63\u5728\u76f4\u64ad</a></li>":s+="<li><span class='time'>"+r[o].start+"</span>"+r[o].name+"</li>";s+="</ul>",W("#live-list .list-container .list-item").html(i+s)}var e=W("#player .views ul"),t=0;W("#player .tabs a").on("mouseenter",function(){var n=W(this);clearTimeout(t),t=setTimeout(function(){var t=n.previousSiblings("a").length;n.addClass("active").siblings("a").removeClass("active"),e.item(t).addClass("active").siblings("ul").removeClass("active")},100)}).on("click",function(e){e.preventDefault()}).on("mouseleave",function(){clearTimeout(t)});var n="favChannel",r=cacheSvc.ins("live"),i=r.get(n)||{},s={add:function(e){i[e]="",r.set(n,i),s.container.insert("afterbegin",g(s.createLiHtml(e)))},remove:function(e){delete i[e],r.set(n,i),s.container.removeChild(W('li[data-channel="'+e+'"]'))},createLiHtml:function(e){var t=W('#player .left .save[data-channel="'+e+'"]').addClass("saved").html("\u5df2\u6536\u85cf").siblings(".channel").html();if(!t)return"";var n=['<li data-channel="',e,'"><a href="/live/',e,'/" class="channel">',t,'</a><a href="###" class="save" data-channel="',e,'">\u53d6\u6d88</a></li>'].join("");return n},init:function(e){s.container=W(e);var t=[];for(var n in i){var r=s.createLiHtml(n);r&&t.unshift(r)}var o=t.join("");s.container.html(o)}};s.init("#fav-channel"),W("#player .left").delegate(".save","click",function(e){e.preventDefault();var t=W(this),n=t.attr("data-channel");i[n]==undefined?(s.add(n),t.addClass("saved").html("\u5df2\u6536\u85cf")):(s.remove(n),W('#left-views .saved[data-channel="'+n+'"]').removeClass("saved").html("\u6536\u85cf"))});var o=W("#player .clock"),u=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"];f(),W("#page-light").click(function(){if(W("#black-mask").length==0&&W("#player-mask").length==0){var e=g('<div id="black-mask" style="height:'+Dom.getDocRect().scrollHeight+'px;"></div>'),t=g('<div class="player-mask" id="player-mask"></div>');W("#bd").insert("afterend",e),W("#player").insert("beforeend",t)}var n=W(this);W("#black-mask, #player-mask").toggle(),n.hasClass("open")?n.removeClass("open"):n.addClass("open")}),W(window).on("resize",function(){W("#black-mask").css("height",Dom.getDocRect().scrollHeight+"px")}),Dom.ready(function(){W(".announcement-container").show()}),l("js-leTabview"),W(".js-leDropdown .dropdown-toggle").on("click",function(e){e.preventDefault(),e.stopPropagation(),W(".js-leDropdown .dropdown-menu").toggle()}),W("#city-close").on("click",function(e){e.preventDefault(),W(".js-leDropdown .dropdown-menu").toggle()}),W(".js-leDropdown .dropdown-menu").on("click",function(e){e.stopPropagation()}),W(document).on("click",function(e){W(".js-leDropdown .dropdown-menu").hide()}),W("#city-list").delegate("a","click",function(e){e.preventDefault();var t=this,n=this.href;W(this).attr("data-liveid")&&loadJsonp("http://v.360.cn/live/epg?live="+W(this).attr("data-liveid")+"&day="+W("#live-list").attr("data-curDate")+"&jsonp=%callbackfun%",function(e){c(e,n)},{oncomplete:function(){W("#live-list").attr("data-liveid",W(t).attr("data-liveid")).attr("data-liveurl",n),W(".js-leDropdown .dropdown-menu").toggle(),W(".js-leDropdown .dropdown-toggle").html(W(t).html()+'<i class="caret"></i>')}})}),W("#live-list .day-tabs").delegate("a","click",function(e){e.preventDefault();var t=this,n=W("#live-list").attr("data-liveurl");loadJsonp("http://v.360.cn/live/epg?live="+W("#live-list").attr("data-liveid")+"&day="+W(this).query(".date").html()+"&jsonp=%callbackfun%",function(e){c(e,n)},{oncomplete:function(){W("#live-list .day-tabs a").removeClass("on"),W(t).addClass("on"),W("#live-list").attr("data-curDate",W(t).query(".date").html())}})})})();